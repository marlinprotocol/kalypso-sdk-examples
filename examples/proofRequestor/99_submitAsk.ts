import { KalspsoConfig } from "kalypso-sdk/dist/types";
import { KalypsoSdk } from "kalypso-sdk";

import { ethers } from "ethers";

import BigNumber from "bignumber.js";

import * as fs from "fs";
import { marketId } from "../../requestData.json";

const attestation4533 = {
  "attestation": "0x8444a1013822a0591149a9696d6f64756c655f69647827692d30663163643737643337666438626363392d656e633031386537616136316532303430666666646967657374665348413338346974696d657374616d701b00000192bd6ad0116470637273b0005830189038eccf28a3a098949e402f3b3d86a876f4915c5b02d546abb5d8c507ceb1755b8192d8cfca66e8f226160ca4c7a60158305d3938eb05288e20a981038b1861062ff4174884968a39aee5982b312894e60561883576cc7381d1a7d05b809936bd160258306c3ef363c488a9a86faa63a44653fd806e645d4540b40540876f3b811fc1bceecf036a4703f07587c501ee45bb56a1aa03583000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004583045ff8769d16a46d16fcf4b872b546b02d587267a16d2325fb968453c0e36e243d04389e45466191967ceb1978012a9cf0558300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000658300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000758300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000858300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000958300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006b63657274696669636174655902813082027d30820203a0030201020210018e7aa61e2040ff000000006719da04300a06082a8648ce3d04030330818f310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313a303806035504030c31692d30663163643737643337666438626363392e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573301e170d3234313032343035323431375a170d3234313032343038323432305a308194310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313f303d06035504030c36692d30663163643737643337666438626363392d656e63303138653761613631653230343066662e61702d736f7574682d312e6177733076301006072a8648ce3d020106052b8104002203620004ebd998e0b89cf4ab60ff8b83964ae06d0374edd605cb7972a473659eaf7e94cf72ce1078bcfe4aabf6e6a88296c1a7f8e180f596c5b204fa1e203b7231c4d943d6e13380500dc7ce1e11ab50e09d476a969c3ae3857d74b12e7e1737425ab75ba31d301b300c0603551d130101ff04023000300b0603551d0f0404030206c0300a06082a8648ce3d04030303680030650230024a14bc4504662b9af0afd57c4753ec82b054728faba6c9098bec17151f14f81bce1ac5e0055b26a8e4e90df796b74d023100954521c1a6eb548d9e32395e02378ff13533ce17693cc348d152a89fd385268747524ebe7039c3d7b58839e12e38940a68636162756e646c65845902153082021130820196a003020102021100f93175681b90afe11d46ccb4e4e7f856300a06082a8648ce3d0403033049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c61766573301e170d3139313032383133323830355a170d3439313032383134323830355a3049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b8104002203620004fc0254eba608c1f36870e29ada90be46383292736e894bfff672d989444b5051e534a4b1f6dbe3c0bc581a32b7b176070ede12d69a3fea211b66e752cf7dd1dd095f6f1370f4170843d9dc100121e4cf63012809664487c9796284304dc53ff4a3423040300f0603551d130101ff040530030101ff301d0603551d0e041604149025b50dd90547e796c396fa729dcf99a9df4b96300e0603551d0f0101ff040403020186300a06082a8648ce3d0403030369003066023100a37f2f91a1c9bd5ee7b8627c1698d255038e1f0343f95b63a9628c3d39809545a11ebcbf2e3b55d8aeee71b4c3d6adf3023100a2f39b1605b27028a5dd4ba069b5016e65b4fbde8fe0061d6a53197f9cdaf5d943bc61fc2beb03cb6fee8d2302f3dff65902c3308202bf30820246a003020102021100d48b0a8617f1e072681f232abd4f9275300a06082a8648ce3d0403033049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c61766573301e170d3234313032333039323535345a170d3234313131323130323535345a3065310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c034157533137303506035504030c2e363065633666363432376439316336622e61702d736f7574682d312e6177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b8104002203620004e9ca6ac9dbea21183e6922ab22849e9aff2670c9fa2c0864976f13862b9764dfe8a71e174f2c17b5376fc38b7638029d8b672a6769d109c8355bc8a00b7ed7f9f4f209b7ff09e70c07425119b19d3ab16927ca00247148e8f83adcb897faee55a381d53081d230120603551d130101ff040830060101ff020102301f0603551d230418301680149025b50dd90547e796c396fa729dcf99a9df4b96301d0603551d0e04160414b2bf4e5dc092b576ddfdfb3c178ac358285beef8300e0603551d0f0101ff040403020186306c0603551d1f046530633061a05fa05d865b687474703a2f2f6177732d6e6974726f2d656e636c617665732d63726c2e73332e616d617a6f6e6177732e636f6d2f63726c2f61623439363063632d376436332d343262642d396539662d3539333338636236376638342e63726c300a06082a8648ce3d040303036700306402306fba93b8f32fe3a514d6046fbb61764363791391103fb3a46ecbecb2cd0cd3fde7491d622a1b3917952a48df3a1ad74102304960c526cf58768ebc184bcf8f9c28f7a107edc74dd9a41ee647277563b143a471f347e9065a2e16f75bfd87c48a8de859031b308203173082029ea0030201020210430f67755bb1a54a13f9a4e07fca047c300a06082a8648ce3d0403033065310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c034157533137303506035504030c2e363065633666363432376439316336622e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573301e170d3234313032333139333034395a170d3234313032393230333034385a30818a313d303b06035504030c34393433643266393066343162656238382e7a6f6e616c2e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573310c300a060355040b0c03415753310f300d060355040a0c06416d617a6f6e310b3009060355040613025553310b300906035504080c0257413110300e06035504070c0753656174746c653076301006072a8648ce3d020106052b81040022036200046f3895431f71c59787f7744d0bf178d40ddbd8c915889fdc312ffa70c199b6aae7a6118e201822e3671fcbcfba536a45a9c407cb626d20a68c1a7f92a0365004be7205d32482a582499824165f44e600aa33c952e65e7ee48e81988c15494d01a381ec3081e930120603551d130101ff040830060101ff020101301f0603551d23041830168014b2bf4e5dc092b576ddfdfb3c178ac358285beef8301d0603551d0e041604144fec4411d6ee6c35991c2c62ec3e0a03b7ba7537300e0603551d0f0101ff0404030201863081820603551d1f047b30793077a075a0738671687474703a2f2f63726c2d61702d736f7574682d312d6177732d6e6974726f2d656e636c617665732e73332e61702d736f7574682d312e616d617a6f6e6177732e636f6d2f63726c2f33393936303562622d326338392d343835382d383765392d3632353833346463353165652e63726c300a06082a8648ce3d040303036700306402307017f589d65385b69f02e410ba78c2e4f75f1f0deb1aa924dc0b3742c6570f70d95b3721e279351c838a64a3f8a9275a02303f794d5bd60168d19ae16b0e21125b7e46b3a8b3383cbc4432cb01758029ad0b28e8d517ec7c68df48ca5a653e43b28e5902c6308202c230820247a003020102021500ef105e145771b70ef0b994908c65f1d0ed537fca300a06082a8648ce3d04030330818a313d303b06035504030c34393433643266393066343162656238382e7a6f6e616c2e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573310c300a060355040b0c03415753310f300d060355040a0c06416d617a6f6e310b3009060355040613025553310b300906035504080c0257413110300e06035504070c0753656174746c65301e170d3234313032343031353235315a170d3234313032353031353235315a30818f310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313a303806035504030c31692d30663163643737643337666438626363392e61702d736f7574682d312e6177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b81040022036200042a30ab9f5d85987d53bfb07157545c67c60d81dc57c4d02df40cd2d043f03791ec3aa82b20a240495be4f99c75f1c814a5d137d620338c5c4290a8de797086a8ede82f10aa3331d69230f11aa9915f10e60ee991c679b46819033ca4a27c8eaba366306430120603551d130101ff040830060101ff020100300e0603551d0f0101ff040403020204301d0603551d0e04160414282cb45dc3353f695ba02779e7bc842d6dde3b98301f0603551d230418301680144fec4411d6ee6c35991c2c62ec3e0a03b7ba7537300a06082a8648ce3d04030303690030660231008722ac2d80a09c538c2768ef21e072b29c99f90e537c075adbbc2aad68b89c5bb5ecb22177e9a64c0a3440f00a549de902310093b2fd8d563fae1b117810ef50854d5eac6391d60612b8330968e7f1f9ae0bd820e65c920905ab98431114e5612fc9016a7075626c69635f6b65795840e646f8b0071d5ba75931402522cc6a5c42a84a6fea238864e5ac9a0e12d83bd36d0c8109d3ca2b699fce8d082bf313f5d2ae249bb275b6b6e91e0fcd9262f4bb69757365725f64617461f6656e6f6e6365f65860b9d35b87623d7da936958390645b4b197404a4d316d46693c921d95353eac8cf2892c85f74fa79881c77e0d4075b7b9769981b1461427d569f7391b9cd219b36c1250655c9dd2e00d34aaec94bc1bd2aadc7669ba3a5fa54e5c09af52648ff6e"
}

const attestation4534 = {
  "attestation": "0x8444a1013822a059114aa9696d6f64756c655f69647827692d30623563393837373230376135636339302d656e633031393238613865363832396236636366646967657374665348413338346974696d657374616d701b00000192fb7434ff6470637273b000583079f30b845cf0fe67f960adc84cdd5e80bcf06a96640acf4dbc393e277ba73782020c16188ad3fd0f60b0121a2f2da968015830bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f025830c580b951db7b9981bde4ec14d7c1bc8cce2d51b873cdd4a47a34c5d4279163b0928c82bc3410cc405301be66357f3ddd035830000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000045830d30d6722a01ef5305be762214d6aba1206a38a87981916f5748cb0c18c5b5090c97724cb37929c5d27108035b7d918260558300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000658300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000758300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000858300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000958300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006b63657274696669636174655902813082027d30820203a003020102021001928a8e6829b6cc000000006729c6a9300a06082a8648ce3d04030330818f310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313a303806035504030c31692d30623563393837373230376135636339302e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573301e170d3234313130353037313735385a170d3234313130353130313830315a308194310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313f303d06035504030c36692d30623563393837373230376135636339302d656e63303139323861386536383239623663632e61702d736f7574682d312e6177733076301006072a8648ce3d020106052b8104002203620004dba3eed397b41c778e6a1e60adbea5b7b1b411caafb686c718bcd296f5eaa540eb36a2e96eaa508642d3d65266ccb6ef0161b86eaa1950a0c93508efc0c11557a9ed47fecb2d210f41ba3217f5ed4473189a981c7b0df6bab3007cc4c1cd2ac1a31d301b300c0603551d130101ff04023000300b0603551d0f0404030206c0300a06082a8648ce3d04030303680030650230381bd644467b46e8c6797ad7601736f99f4d2c44fca5546398cf69e908c76e2af4b41b90bce9c832cabc09af46643e89023100f06c91bb3ce67d9b9815bd0345b0af44ae337f728d048c6f8225d9c95f4db90e28ee2a0c072fec738b6e30e3a03dff0768636162756e646c65845902153082021130820196a003020102021100f93175681b90afe11d46ccb4e4e7f856300a06082a8648ce3d0403033049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c61766573301e170d3139313032383133323830355a170d3439313032383134323830355a3049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b8104002203620004fc0254eba608c1f36870e29ada90be46383292736e894bfff672d989444b5051e534a4b1f6dbe3c0bc581a32b7b176070ede12d69a3fea211b66e752cf7dd1dd095f6f1370f4170843d9dc100121e4cf63012809664487c9796284304dc53ff4a3423040300f0603551d130101ff040530030101ff301d0603551d0e041604149025b50dd90547e796c396fa729dcf99a9df4b96300e0603551d0f0101ff040403020186300a06082a8648ce3d0403030369003066023100a37f2f91a1c9bd5ee7b8627c1698d255038e1f0343f95b63a9628c3d39809545a11ebcbf2e3b55d8aeee71b4c3d6adf3023100a2f39b1605b27028a5dd4ba069b5016e65b4fbde8fe0061d6a53197f9cdaf5d943bc61fc2beb03cb6fee8d2302f3dff65902c3308202bf30820245a0030201020210703ddc7da0563f8ef2556f48939ae5c1300a06082a8648ce3d0403033049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c61766573301e170d3234313130323038323535345a170d3234313132323039323535345a3065310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c034157533137303506035504030c2e386336343865386232643166333838332e61702d736f7574682d312e6177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b8104002203620004310c7614239fe25a2d6383c93ba7381cd0e69347af2abfde59b44dc4aaaaf50ef6d409feacdde2b0281dc0aa3c16523c5d03a562b131674ec5ce4a7ca141270c7ca2d3e41e1bd031a74cbf4b5eb3fffb1d9f9e2dd3bfd53f43a0580f678142eca381d53081d230120603551d130101ff040830060101ff020102301f0603551d230418301680149025b50dd90547e796c396fa729dcf99a9df4b96301d0603551d0e0416041495433e4a902468da55762c95016d6a3b7e366c07300e0603551d0f0101ff040403020186306c0603551d1f046530633061a05fa05d865b687474703a2f2f6177732d6e6974726f2d656e636c617665732d63726c2e73332e616d617a6f6e6177732e636f6d2f63726c2f61623439363063632d376436332d343262642d396539662d3539333338636236376638342e63726c300a06082a8648ce3d040303036800306502300e40dad16dcdf51a811ebc926f68d99e039cba224090b965e6d87a2514b17e1e69381d2cc75c381121555c45d97092b6023100ab700299f3f9a92da1ca22966d7224a86e4151b1fc43658ab9b27b7f15c6e0d011660894e557e7d94fa437acf7424e3659031d308203193082029fa003020102021100af705d7a279dd81dc53ba4119741f8cc300a06082a8648ce3d0403033065310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c034157533137303506035504030c2e386336343865386232643166333838332e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573301e170d3234313130343135333234365a170d3234313131303034333234355a30818a313d303b06035504030c34346235613962316630343533373233652e7a6f6e616c2e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573310c300a060355040b0c03415753310f300d060355040a0c06416d617a6f6e310b3009060355040613025553310b300906035504080c0257413110300e06035504070c0753656174746c653076301006072a8648ce3d020106052b8104002203620004449a6e773f728bb8a345cb15243c2bdef55195149019110a33cfcf13c15faed4f9fb1cc7714ba0d4dfca702e2762a00379c1dc8dcc6e795e44f0d56bf523dbabee6efe9fd313533741f8ee9122739c341286ed3c488d2cf2c04077825b9adb40a381ec3081e930120603551d130101ff040830060101ff020101301f0603551d2304183016801495433e4a902468da55762c95016d6a3b7e366c07301d0603551d0e04160414be142f98cbe6311352d4311ccb91f455350475f2300e0603551d0f0101ff0404030201863081820603551d1f047b30793077a075a0738671687474703a2f2f63726c2d61702d736f7574682d312d6177732d6e6974726f2d656e636c617665732e73332e61702d736f7574682d312e616d617a6f6e6177732e636f6d2f63726c2f63643461316138362d386132342d343862332d613934652d3164333739653133373363392e63726c300a06082a8648ce3d0403030368003065023100b48848a8fa7229b542ce5414c64776ebaadf1aa544c3c890a50731fdf0e4881c6a5a3be785a90dfab7a4d9f3065937bf0230488bc221ab1977938a31081aa423b26d25c8c954b05d041935a4c95121288a52d3c61a59464532c3864b08eec4b6dc7f5902c5308202c130820246a00302010202144ae5f925231ea0de47b1c90fc1b42e0004621d7f300a06082a8648ce3d04030330818a313d303b06035504030c34346235613962316630343533373233652e7a6f6e616c2e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573310c300a060355040b0c03415753310f300d060355040a0c06416d617a6f6e310b3009060355040613025553310b300906035504080c0257413110300e06035504070c0753656174746c65301e170d3234313130343233343131315a170d3234313130353233343131315a30818f310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313a303806035504030c31692d30623563393837373230376135636339302e61702d736f7574682d312e6177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b81040022036200047ff8f81f0e4eaa46f0379f657e5e9b987ea34229d2277e9fe09b3afd26d9a8697514c91b974f359bb219221733c6bbb999a63da941debfa8ae15ff9688d9746c73f6c36f3227fbbd18336b89067c8a6f8281355393b6e03e771158e8dc9b2b96a366306430120603551d130101ff040830060101ff020100300e0603551d0f0101ff040403020204301d0603551d0e041604141168622442fe08035ed69e314e09ddc215f95716301f0603551d23041830168014be142f98cbe6311352d4311ccb91f455350475f2300a06082a8648ce3d0403030369003066023100f2ef2eb1eb32073b61dfb8b866fbc15c0847e95f1735164c99d3df93d5739292f41f5a778b270df1193bdb62fe8e4806023100db948d1a29ca1e862bddd42f7249b9f6d45339f9ddebdb690536f98cb176a4ae2eca2a7502ca36aaba20366711266d1f6a7075626c69635f6b65795840e820ad05039fc7b1d4446619aee7e47955a8e52ed7beed96074f2d4b7468db952abd9320609ba0a351ae3720a72cc6d42b5e03bb95ee5ec7f62ea0c0bad0b75669757365725f64617461f6656e6f6e6365f65860edf9228637061ed0d8715c4c5cd7d4dfb4e7efa72f1230170d00d59736dfd424b5fd21568ad5922fa60d4c4b17d869044e5c65bf676b6c0d82627dad7896885190887eb4274dbf639d6bb955fd9d96869c00033ab14a4b34294c37f150d3363d"
}

const attestation_dont_know = {
  "attestation": "0x8444a1013822a059114ca9696d6f64756c655f69647827692d30333761643062666262303136366362322d656e633031393330313339386533363639666266646967657374665348413338346974696d657374616d701b0000019301426cd06470637273b0005830f114d8550439add43143ad1b570d1ce191bf86355471c3f5498843eb4b147b014fac0c42f508d46ef87fb5eb12d8bac50158300343b056cd8485ca7890ddd833476d78460aed2aa161548e4e26bedf321726696257d623e8805f3f605946b3d8b0c6aa02583025badc5bfc056f15e6458e6ac789ab4bcf630f942ea173b6f72ad51456a5dcc655c3d1b25f2c8450d8eaee82a1f4c3c9035830000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000045830519bc97304b6482652b1271a952851329f880ba65bca61026f99981125219ee6576be9fdddfa3b14d7936f6b48eb6a8d0558300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000658300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000758300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000858300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000958300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f58300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006b63657274696669636174655902823082027e30820203a0030201020210019301398e3669fb00000000672b5259300a06082a8648ce3d04030330818f310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313a303806035504030c31692d30333761643062666262303136366362322e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573301e170d3234313130363131323631345a170d3234313130363134323631375a308194310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313f303d06035504030c36692d30333761643062666262303136366362322d656e63303139333031333938653336363966622e61702d736f7574682d312e6177733076301006072a8648ce3d020106052b8104002203620004f7adbac081be048b63f2bda578b0fd100ba906dd1a6e1013269505dbafe2a7061dfa239a778412ac3a64a4c090d81b24036fae0cfcd7ca8ea328fe4349e45338cacc3def6411c9853667e947f484069a03b0aa031c447d65129949d0b5f60268a31d301b300c0603551d130101ff04023000300b0603551d0f0404030206c0300a06082a8648ce3d0403030369003066023100c766eb53ae492c579f8b3ad080de4908beb0f795ebed0d6dfec13777857f18d34b6d5155689ff8518d81fec296fa8bf5023100ac5ed6cd7cc6c2c3eb6e1d9d87a909a54b52d7f71853083b0c7ed5ba57a0329e841894bbb8f662b3742b6fa51d07949268636162756e646c65845902153082021130820196a003020102021100f93175681b90afe11d46ccb4e4e7f856300a06082a8648ce3d0403033049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c61766573301e170d3139313032383133323830355a170d3439313032383134323830355a3049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b8104002203620004fc0254eba608c1f36870e29ada90be46383292736e894bfff672d989444b5051e534a4b1f6dbe3c0bc581a32b7b176070ede12d69a3fea211b66e752cf7dd1dd095f6f1370f4170843d9dc100121e4cf63012809664487c9796284304dc53ff4a3423040300f0603551d130101ff040530030101ff301d0603551d0e041604149025b50dd90547e796c396fa729dcf99a9df4b96300e0603551d0f0101ff040403020186300a06082a8648ce3d0403030369003066023100a37f2f91a1c9bd5ee7b8627c1698d255038e1f0343f95b63a9628c3d39809545a11ebcbf2e3b55d8aeee71b4c3d6adf3023100a2f39b1605b27028a5dd4ba069b5016e65b4fbde8fe0061d6a53197f9cdaf5d943bc61fc2beb03cb6fee8d2302f3dff65902c3308202bf30820245a0030201020210703ddc7da0563f8ef2556f48939ae5c1300a06082a8648ce3d0403033049310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b301906035504030c126177732e6e6974726f2d656e636c61766573301e170d3234313130323038323535345a170d3234313132323039323535345a3065310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c034157533137303506035504030c2e386336343865386232643166333838332e61702d736f7574682d312e6177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b8104002203620004310c7614239fe25a2d6383c93ba7381cd0e69347af2abfde59b44dc4aaaaf50ef6d409feacdde2b0281dc0aa3c16523c5d03a562b131674ec5ce4a7ca141270c7ca2d3e41e1bd031a74cbf4b5eb3fffb1d9f9e2dd3bfd53f43a0580f678142eca381d53081d230120603551d130101ff040830060101ff020102301f0603551d230418301680149025b50dd90547e796c396fa729dcf99a9df4b96301d0603551d0e0416041495433e4a902468da55762c95016d6a3b7e366c07300e0603551d0f0101ff040403020186306c0603551d1f046530633061a05fa05d865b687474703a2f2f6177732d6e6974726f2d656e636c617665732d63726c2e73332e616d617a6f6e6177732e636f6d2f63726c2f61623439363063632d376436332d343262642d396539662d3539333338636236376638342e63726c300a06082a8648ce3d040303036800306502300e40dad16dcdf51a811ebc926f68d99e039cba224090b965e6d87a2514b17e1e69381d2cc75c381121555c45d97092b6023100ab700299f3f9a92da1ca22966d7224a86e4151b1fc43658ab9b27b7f15c6e0d011660894e557e7d94fa437acf7424e3659031e3082031a3082029fa0030201020211008933aad580a7124e47fd4acfcbf4df26300a06082a8648ce3d0403033065310b3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b0c034157533137303506035504030c2e386336343865386232643166333838332e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573301e170d3234313130363032323633395a170d3234313131323032323633395a30818a313d303b06035504030c34633935393761343432616437363039382e7a6f6e616c2e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573310c300a060355040b0c03415753310f300d060355040a0c06416d617a6f6e310b3009060355040613025553310b300906035504080c0257413110300e06035504070c0753656174746c653076301006072a8648ce3d020106052b8104002203620004c3e3d218096380f0eec34fce998142315db3933c8492efc6d30dca7e8a882f490d3d0d12abcce42881f01e81491bacaaf1b6d460ae203399a68896b9b3b21566b8321f3238680d24649084e09b8c360e7dd92b6eae3c5aac5631c3f3fa554f72a381ec3081e930120603551d130101ff040830060101ff020101301f0603551d2304183016801495433e4a902468da55762c95016d6a3b7e366c07301d0603551d0e04160414049cadba03fa8c2b2bcbde4f5087ae1ce46cf841300e0603551d0f0101ff0404030201863081820603551d1f047b30793077a075a0738671687474703a2f2f63726c2d61702d736f7574682d312d6177732d6e6974726f2d656e636c617665732e73332e61702d736f7574682d312e616d617a6f6e6177732e636f6d2f63726c2f63643461316138362d386132342d343862332d613934652d3164333739653133373363392e63726c300a06082a8648ce3d0403030369003066023100c1e022b55a39336a83e24c667504adcd09022d2fe2851c870d52d8725ab37ad7b4f371bd7f21eed38f58d776ae914fa6023100f8aa5442777e20d8e98ec6d5eb0bc08dc9ae929848310f850219bb7f2b08301831e0dd7835e8fb734086bb9fbd04e9355902c5308202c130820247a003020102021500b53698602c0ae30c10c31584a049783d1b75d9b5300a06082a8648ce3d04030330818a313d303b06035504030c34633935393761343432616437363039382e7a6f6e616c2e61702d736f7574682d312e6177732e6e6974726f2d656e636c61766573310c300a060355040b0c03415753310f300d060355040a0c06416d617a6f6e310b3009060355040613025553310b300906035504080c0257413110300e06035504070c0753656174746c65301e170d3234313130363131303233325a170d3234313130373131303233325a30818f310b30090603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753313a303806035504030c31692d30333761643062666262303136366362322e61702d736f7574682d312e6177732e6e6974726f2d656e636c617665733076301006072a8648ce3d020106052b81040022036200047ece18b9de4126edc6844a28025cd45522b675743fca239fed160c557754e9818e396a172ed341ba9a359df90d0a2f9abf777a987c8c9c3e337d996232082bac608359727ed4c7d9e75d1fe01066a99dfd94a0629d9888b56a49d57b2f2024c3a366306430120603551d130101ff040830060101ff020100300e0603551d0f0101ff040403020204301d0603551d0e041604145fa4dd2d72c18ae20811bc06a795bd9e1be86614301f0603551d23041830168014049cadba03fa8c2b2bcbde4f5087ae1ce46cf841300a06082a8648ce3d0403030368003065023100b24f33fe0fc1cea61f3501ed3d11d14fd77bab48f5a17205100ed466948b5e18d24d7cf39c532a3b26221611b77b35250230142db73b30d5900a82ebb796865897d9e1fbd55e64b7b6c53a510e2ea0a90a45e52767ec77787c0bdbe2fe4a18a70dd86a7075626c69635f6b657958403bbac8fd8de1857361bd70024634b96d2dbc441444bab298853383c479c7f5f07172ed4fd01557125c5b1ad97753a6ab574794785bd1e61b5b67b154abed1ae669757365725f64617461f6656e6f6e6365f65860ac38d7a81352e8968ff50694edd9cbebae2be796eb4fa315001ac55302dd5828a2db42e838b06a256e67a03ff7df0af244c61150e89ca3a4cb1355bacdac7751121caa89452b914267f432e63dae8c8861c3e73983a437341bbf00b0066a020e"
}
// const attestation = attestation4533;
// const attestation = attestation4534;
const attestation = attestation_dont_know;

console.log("attestation length", attestation.attestation.length/2 -1);



const kalypsoConfig: KalspsoConfig = JSON.parse(
  fs.readFileSync("./contracts/arb-sepolia.json", "utf-8")
);
const keys = JSON.parse(fs.readFileSync("./keys/arb-sepolia.json", "utf-8"));

const reward = new BigNumber(10).pow(18).multipliedBy(145).div(10).toFixed(0);

const createAskTest = async () => {
  const provider = new ethers.JsonRpcProvider(keys.rpc);
  const wallet = new ethers.Wallet(keys.treasury_private_key, provider);

  console.log("using address", await wallet.getAddress());


  const kalypso = new KalypsoSdk(wallet as any, kalypsoConfig);
  const matchingEngineKey = (
    await kalypso.MarketPlace().readMePubKeyInContract()
  ).toString();
  // const matchingEngineKey =
  //   "0x83717e9d52af153aeee3b0f6258b40581ee0921cefc47a6e1cd3258aa85189151c232098116477dd901f20216fe9b25a4569cbce61f6fc33eca3070b4b2405f1";
  console.log({ matchingEngineKey });


  // const latestBlock = await provider.getBlockNumber();

  const assignmentDeadline = new BigNumber(0).plus(1000000000000);
  console.log({
    // latestBlock,
    assignmentDeadline: assignmentDeadline.toFixed(0),
  });
  const proofGenerationTimeInBlocks = new BigNumber(1000000000000);
  {
    const date = new Date();
    console.log(
      "start encrypting the request",
      date.getMinutes(),
      ":",
      date.getSeconds()
    );
  }

  const empty = Buffer.from("0x");

  // 2.TODO. Verify before whether this request is provable before shooting request out
  const askRequest = await kalypso
    .MarketPlace()
    .createAsk(
      marketId,
      attestation.attestation,
      reward,
      assignmentDeadline.toFixed(0),
      proofGenerationTimeInBlocks.toFixed(0),
      await wallet.getAddress(),
      0, // TODO: keep this 0 for now
      empty
    );
  let tx = await askRequest.wait(10);
  const date = new Date();
  console.log(
    "completed placing the request on chain",
    date.getMinutes(),
    ":",
    date.getSeconds()
  );

  console.log(
    "Ask Request Hash: ",
    askRequest.hash,
    " at block",
    tx?.blockNumber
  );

  const askId = await kalypso.MarketPlace().getAskId(tx as any);

  const proof = await kalypso
    .MarketPlace()
    .getProofByAskId(askId, tx!.blockNumber);
  console.log({ proof });
};

createAskTest();
